generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String     @id @default(cuid())
  name          String?
  email         String?    @unique
  image         String?
  emailVerified DateTime?
  profile       Profile?
  accounts      Account[]
  sessions      Session[]
  hospitals     Hospital[]
  patients      Patient[]
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model Profile {
  userId      String    @id
  role        String    @default("user")
  designation String?
  stationId   String?
  email       String?
  fullName    String?
  contact1    String?
  contact2    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  station     Hospital? @relation(fields: [stationId], references: [id])
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String

  refresh_token String?
  access_token  String?
  expires_at    Int?
  token_type    String?
  scope         String?
  id_token      String?
  session_state String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

model Hospital {
  id             String     @id @default(cuid())
  name           String     @unique
  location       String
  registrationNo String     @unique
  incharge       String?
  userId         String
  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  profiles       Profile[]
  patients       Patient[]
  suppliers      Supplier[]
  assets         Asset[]

  @@index([name])
}

model Role {
  id          String   @id @default(cuid())
  name        String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Patient {
  id             String   @id @default(cuid())
  email          String?
  fullName       String
  tel1           String
  tel2           String?
  identity       String   @unique
  dob            String
  sex            String
  location       String
  medicalHistory String?
  notes          String?
  refferedBy     String?
  servedById     String
  hospitalId     String
  hospital       Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  user           User     @relation(fields: [servedById], references: [id], onDelete: Cascade)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Supplier {
  id          String   @id @default(cuid())
  name        String
  tel         String
  description String
  hospitalId  String
  hospital    Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Asset {
  id          String   @id @default(cuid())
  name        String
  description String
  pic         String
  value       Int
  status      String
  hospitalId  String
  hospital    Hospital @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
